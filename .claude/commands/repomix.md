---
description: "Explore the codebase, create robust .repomixignore and repomix.config.json files, and pack repository for AI analysis"
allowed-tools: Task,Read,Write,Edit,Glob,Grep,Bash,AskUserQuestion
---

# Repomix Setup and Pack Command

Create optimized repomix configuration for this codebase and optionally pack it for AI analysis.

## Arguments

Parse `$ARGUMENTS` for optional flags:

- `--pack` or `-p`: After creating configs, also run repomix to pack the repository
- `--output <path>` or `-o <path>`: Custom output path for the packed file
- `--style <format>`: Output style (markdown, text, json, table). Default: markdown
- `--copy` or `-c`: Copy output to clipboard after packing
- `--force` or `-f`: Overwrite existing config files without prompting

If no arguments provided, just create/update configuration files.

## Workflow

### Phase 1: Codebase Analysis

First, thoroughly explore the codebase to understand its structure. Use the Task tool with `subagent_type: "codebase-explorer"` and `model: "haiku"`:

```
Explore this codebase to identify:

1. **Languages & Frameworks**
   - Primary programming languages (check file extensions)
   - Frameworks (package.json, requirements.txt, Cargo.toml, go.mod, Gemfile, etc.)
   - Runtime versions (.nvmrc, .python-version, .ruby-version, .tool-versions)

2. **Build & Bundling**
   - Build tools (webpack, vite, esbuild, rollup, turbopack, etc.)
   - Output directories (dist/, build/, out/, .next/, .nuxt/, etc.)
   - Generated files patterns

3. **Dependencies**
   - Package managers (npm, yarn, pnpm, pip, poetry, cargo, go modules)
   - Lock files and cache directories
   - Vendored dependencies

4. **Development Environment**
   - IDE configurations (.vscode/, .idea/, *.code-workspace)
   - Editor settings (.editorconfig, .prettierrc, .eslintrc)
   - Git hooks (.husky/, .git-hooks/)

5. **Testing**
   - Test frameworks (jest, vitest, pytest, rspec, go test)
   - Coverage directories (coverage/, .nyc_output/, htmlcov/)
   - Test artifacts and snapshots

6. **Infrastructure & Deployment**
   - Docker files and artifacts
   - CI/CD configs (.github/, .gitlab-ci.yml, .circleci/)
   - Cloud configs (terraform/, pulumi/, .aws/, .gcloud/)

7. **Security-Sensitive Files**
   - Environment files (.env*, .env.local, .env.*.local)
   - Secrets and credentials (*.pem, *.key, credentials.json)
   - Local configuration overrides

8. **Project-Specific Patterns**
   - Any existing .gitignore patterns
   - Any existing .repomixignore patterns
   - README or docs mentioning excluded files

9. **Large/Binary Files**
   - Media assets (images/, assets/, static/)
   - Database files (*.db, *.sqlite)
   - Log files (*.log, logs/)

10. **Monorepo Structure** (if applicable)
    - Package locations
    - Shared dependencies
    - Build caching (nx, turborepo)

Provide a comprehensive structured analysis that will be used to create optimized repomix configuration.
```

### Phase 2: Check Existing Configuration

After receiving analysis, check for existing repomix configuration:

```bash
# Check for existing config files
ls -la .repomixignore repomix.config.json 2>/dev/null || echo "No existing config"
```

If configs exist and `--force` flag not provided, ask user:

Use AskUserQuestion tool:

```
question: "Existing repomix configuration found. How would you like to proceed?"
header: "Config exists"
options:
  - label: "Merge"
    description: "Keep existing patterns and add missing ones from analysis"
  - label: "Replace"
    description: "Create fresh configuration based on new analysis"
  - label: "Skip"
    description: "Keep existing configuration, only pack if --pack specified"
```

### Phase 3: Create .repomixignore

Based on the codebase analysis, create a comprehensive `.repomixignore` file.

**Template Structure:**

```
# =============================================================================
# .repomixignore - Auto-generated by Claude Code
# Project: [PROJECT_NAME]
# Generated: [DATE]
# =============================================================================

# -----------------------------------------------------------------------------
# Version Control
# -----------------------------------------------------------------------------
.git/
.gitignore
.gitattributes
.gitmodules

# -----------------------------------------------------------------------------
# Dependencies
# -----------------------------------------------------------------------------
[DETECTED_DEPENDENCY_DIRS]

# -----------------------------------------------------------------------------
# Build Outputs
# -----------------------------------------------------------------------------
[DETECTED_BUILD_DIRS]

# -----------------------------------------------------------------------------
# IDE & Editor
# -----------------------------------------------------------------------------
[DETECTED_IDE_PATTERNS]

# -----------------------------------------------------------------------------
# Testing & Coverage
# -----------------------------------------------------------------------------
[DETECTED_TEST_ARTIFACTS]

# -----------------------------------------------------------------------------
# Environment & Secrets
# -----------------------------------------------------------------------------
[SECURITY_SENSITIVE_PATTERNS]

# -----------------------------------------------------------------------------
# Logs & Temp Files
# -----------------------------------------------------------------------------
[LOG_AND_TEMP_PATTERNS]

# -----------------------------------------------------------------------------
# OS-Specific
# -----------------------------------------------------------------------------
.DS_Store
Thumbs.db
*.swp
*.swo
*~

# -----------------------------------------------------------------------------
# Large/Binary Files
# -----------------------------------------------------------------------------
[LARGE_FILE_PATTERNS]

# -----------------------------------------------------------------------------
# Project-Specific Exclusions
# -----------------------------------------------------------------------------
[PROJECT_SPECIFIC_PATTERNS]

# -----------------------------------------------------------------------------
# Repomix Output (prevent recursion)
# -----------------------------------------------------------------------------
repomix-output.*
*.repomix.*
context.md
context.txt
context.json
```

**Common Patterns by Technology:**

JavaScript/TypeScript:

```
node_modules/
.npm/
.yarn/
.pnpm-store/
dist/
build/
.next/
.nuxt/
.output/
coverage/
.nyc_output/
*.min.js
*.bundle.js
```

Python:

```
__pycache__/
*.py[cod]
*$py.class
.Python
.venv/
venv/
env/
.env/
.pytest_cache/
.mypy_cache/
.ruff_cache/
htmlcov/
.coverage
*.egg-info/
```

Rust:

```
target/
Cargo.lock
**/*.rs.bk
```

Go:

```
vendor/
go.sum
*.exe
*.exe~
*.dll
*.so
*.dylib
```

### Phase 4: Create repomix.config.json

Create an optimized configuration file:

```json
{
  "$schema": "https://repomix.com/schema.json",
  "output": {
    "filePath": "repomix-output.md",
    "style": "markdown",
    "headerText": "# Repository Context for AI Analysis\n\nThis file contains the codebase context packed by repomix for AI assistant consumption.",
    "instructionFilePath": "",
    "removeComments": false,
    "removeEmptyLines": false,
    "showLineNumbers": true,
    "topFilesLength": 50,
    "copyToClipboard": false
  },
  "include": ["**/*"],
  "ignore": {
    "useGitignore": true,
    "useDefaultPatterns": true,
    "customPatterns": []
  },
  "security": {
    "enableSecurityCheck": true
  }
}
```

**Customize based on analysis:**

- Adjust `topFilesLength` based on project size
- Set appropriate `style` based on project type
- Add `customPatterns` for project-specific exclusions
- Configure `removeComments` based on documentation density

### Phase 5: Pack Repository (if --pack flag)

If `--pack` flag was provided, invoke the repomix-cli agent:

Use Task tool with `subagent_type: "repomix-cli"`:

```
Pack this repository using the newly created configuration.

Configuration created:
- .repomixignore: [SUMMARY_OF_PATTERNS]
- repomix.config.json: [SUMMARY_OF_CONFIG]

Options specified:
- Output: [OUTPUT_PATH or default]
- Style: [STYLE or markdown]
- Copy to clipboard: [yes/no]

Please:
1. Run repomix with the configuration
2. Report the output statistics (file count, size, estimated tokens)
3. Suggest any optimizations if the output is too large
```

### Phase 6: Summary Report

After completion, provide a summary:

````
## Repomix Configuration Complete

### Files Created/Updated:
- `.repomixignore` - [X patterns across Y categories]
- `repomix.config.json` - [configuration summary]

### Technologies Detected:
- [List of detected technologies]

### Key Exclusions:
- Dependencies: [summary]
- Build outputs: [summary]
- Security-sensitive: [summary]

### Recommendations:
- [Any suggestions for further optimization]
- [Token reduction tips if applicable]

### Usage:
```bash
# Pack with current config
repomix

# Pack with custom output
repomix --output context.md

# Pack and copy to clipboard
repomix --copy

# Quick re-run with this command
/repomix --pack
````

```

## Error Handling

### Repomix Not Installed
If repomix is not found:
```

Repomix CLI is not installed. Install it with:

npm install -g repomix

# or

yarn global add repomix

# or

pnpm add -g repomix

Then run this command again.

```

### Permission Issues
If unable to write config files:
```

Unable to write configuration files. Please check:

1. You have write permissions in the current directory
2. The files are not locked by another process
3. Try running with appropriate permissions

```

### Large Repository Warning
If codebase analysis suggests >100MB output:
```

This repository may produce a very large repomix output.

Recommendations:

1. Add more exclusions to .repomixignore
2. Use --include to focus on specific directories
3. Split into multiple context files by component

Would you like me to suggest additional exclusions?

````

## Core Principles

### Parallelization (CRITICAL for Speed)

When gathering context, execute ALL reads in parallel:
- Multiple config file checks -> ONE message with multiple Read calls
- Multiple pattern searches -> ONE message with multiple Grep/Glob calls

### Depth-First Strategy (DFS over BFS)

When analyzing the codebase, go DEEP into each category before moving to the next:
- Complete language/framework detection fully before moving to dependencies
- Finish one technology category completely before starting another

### Architecture Principles

**DRY & OPEN-CLOSED:**
- Reuse existing .gitignore patterns
- Build on existing repomix configurations
- Design exclusion patterns for extension

## Examples

```bash
# Just create configuration files
/repomix

# Create configs and pack immediately
/repomix --pack

# Create configs and pack to specific file
/repomix --pack --output context-for-claude.md

# Create configs, pack, and copy to clipboard
/repomix -p -c

# Force overwrite existing configs
/repomix --force

# Full workflow with all options
/repomix --pack --output ai-context.md --style markdown --copy
````
